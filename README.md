# 延时摄影拍摄程序

这是一个功能完整的延时摄影拍摄程序，提供命令行版本和图形界面版本，支持长时间运行和丰富的参数配置。

## 功能特点

- 🎥 支持多种摄像头设备
- ⏱️ 可调节拍摄间隔（0.1秒 - 1小时）
- 📅 可设置拍摄时长（1分钟 - 7天）
- 🖼️ 支持多种分辨率和图片格式
- 🎬 自动生成延时视频
- 🎛️ 摄像头参数调节（亮度、对比度、饱和度）
- 💾 配置文件保存和加载
- 📊 实时进度显示和状态监控
- 🖥️ 图形界面和命令行两种操作方式

## 文件说明

- `timelapse_camera.py` - 命令行版本的延时摄影程序
- `timelapse_gui.py` - 图形界面版本的延时摄影程序
- `config_example.json` - 配置文件示例
- `requirements.txt` - 依赖包列表

## 安装依赖

```bash
pip install -r requirements.txt
```

主要依赖包：
- `opencv-python` - 摄像头控制和图像处理
- `Pillow` - 图像处理和格式转换
- `numpy` - 数值计算支持

## 使用方法

### 图形界面版本（推荐）

```bash
python timelapse_gui.py
```

图形界面提供了直观的参数配置和实时预览功能：

1. **基本设置**
   - 摄像头索引：选择要使用的摄像头（通常0为默认摄像头）
   - 拍摄间隔：设置每次拍摄的时间间隔
   - 拍摄时长：设置总的拍摄时间
   - 输出目录：选择保存文件的位置
   - 文件名前缀：设置生成文件的名称前缀

2. **图像设置**
   - 分辨率：设置拍摄的图片分辨率
   - 图片格式：选择JPG或PNG格式
   - 图片质量：调节图片压缩质量

3. **摄像头调整**
   - 自动曝光：启用或禁用自动曝光
   - 亮度、对比度、饱和度：手动调节摄像头参数

4. **视频设置**
   - 创建延时视频：是否自动生成视频
   - 视频帧率：设置输出视频的帧率
   - 视频格式：选择MP4或AVI格式
   - 清理图片：视频生成后是否删除原始图片

5. **操作步骤**
   - 点击"测试摄像头"查看预览效果
   - 调整各项参数
   - 点击"开始拍摄"启动延时摄影
   - 可随时点击"停止拍摄"结束录制

### 命令行版本

```bash
python timelapse_camera.py
```

命令行版本支持三种运行模式：

1. **交互式配置模式**
   - 程序会引导您逐步配置各项参数
   - 适合首次使用或需要调整参数的情况

2. **配置文件模式**
   ```bash
   python timelapse_camera.py --config config_example.json
   ```
   - 使用预设的配置文件快速启动
   - 适合重复使用相同配置的情况

3. **命令行参数模式**
   ```bash
   python timelapse_camera.py --interval 5 --duration 60 --output ./output
   ```
   - 直接通过命令行参数指定配置
   - 适合脚本自动化调用

## 配置文件格式

配置文件使用JSON格式，包含以下参数：

```json
{
    "camera_index": 0,
    "interval_seconds": 5.0,
    "duration_minutes": 60.0,
    "resolution": {
        "width": 1920,
        "height": 1080
    },
    "output_directory": "./timelapse_output",
    "image_format": "jpg",
    "image_quality": 95,
    "filename_prefix": "timelapse",
    "camera_settings": {
        "brightness": 0,
        "contrast": 0,
        "saturation": 0,
        "auto_exposure": true
    },
    "video_settings": {
        "create_video": true,
        "fps": 30,
        "format": "mp4",
        "cleanup_images": false
    }
}
```

## 输出文件结构

程序会在指定的输出目录下创建以下文件结构：

```
timelapse_20250120_143022/
├── config.json              # 本次拍摄的配置文件
├── timelapse_000001.jpg     # 拍摄的图片文件
├── timelapse_000002.jpg
├── ...
└── timelapse_timelapse.mp4  # 生成的延时视频（如果启用）
```

## 使用技巧

1. **摄像头选择**
   - 如果有多个摄像头，尝试不同的索引值（0, 1, 2...）
   - 使用"测试摄像头"功能确认设备正常工作

2. **参数调节**
   - 拍摄间隔建议根据场景变化速度调整：
     - 云朵移动：1-5秒
     - 日出日落：10-30秒
     - 植物生长：5-60分钟
   - 分辨率越高，文件越大，处理时间越长

3. **长时间拍摄**
   - 确保电脑不会进入睡眠模式
   - 建议使用稳定的电源供应
   - 定期检查存储空间是否充足

4. **视频生成**
   - 帧率30fps适合大多数场景
   - 如果原始图片较多，视频生成可能需要较长时间
   - 可以选择保留原始图片以便后期重新处理

## 故障排除

1. **摄像头无法打开**
   - 检查摄像头是否被其他程序占用
   - 尝试不同的摄像头索引
   - 确认摄像头驱动正常安装

2. **图片保存失败**
   - 检查输出目录是否有写入权限
   - 确认磁盘空间充足
   - 检查文件名是否包含非法字符

3. **视频生成失败**
   - 确认opencv-python版本支持所选的视频格式
   - 检查是否有足够的内存处理大量图片
   - 尝试降低视频分辨率或帧率

4. **程序运行缓慢**
   - 降低图片分辨率
   - 增加拍摄间隔
   - 关闭不必要的后台程序

## 注意事项

- 长时间拍摄会产生大量文件，请确保有足够的存储空间
- 某些摄像头可能不支持所有的参数调节功能
- 在macOS上可能需要授予程序摄像头访问权限
- 建议在正式拍摄前先进行短时间测试

## 许可证

本程序仅供学习和个人使用，请遵守相关法律法规。